import{j as e,q as n,B as c,z as O,S as h,u as L,r as l,w as G,v as N,D as i,C as R,x as I,p as T,y as E,g as k}from"./index-6zkZJZ_0.js";import{i as M}from"./role-check-5Hlc5mGT.js";import{G as P,A as B}from"./order-iuiToT7p.js";import{E as f}from"./empty-content-HvT411P_.js";import{f as W}from"./format-number-PdjRQbyC.js";import{D as H}from"./DataGrid-0oOUlr-i.js";import{G as U}from"./GridActionsCellItem-4URAVLzW.js";function _({params:r}){return e.jsx(e.Fragment,{children:r.row.serviceDetails.map(s=>e.jsx(n,{disableTypography:!0,primary:e.jsx(c,{component:"div",sx:{typography:"body2",color:"text.disabled"},children:W(s.price)}),sx:{display:"flex",flexDirection:"column"}},s.id))})}function z({params:r}){return e.jsx(O,{variant:"soft",color:r.row.approved&&"info"||"default",children:r.row.approved?"Approved":"Draft"})}function V({params:r}){return e.jsx(n,{primary:r.row.gravestoneDetails.graveSite,primaryTypographyProps:{typography:"body2",noWrap:!0}})}function q({params:r}){return e.jsx(h,{direction:"row",alignItems:"center",sx:{py:2,width:1},children:r.row.serviceDetails.map(s=>e.jsx(n,{disableTypography:!0,primary:e.jsx(c,{component:"div",sx:{typography:"body2",color:"text.disabled"},children:s.name}),sx:{display:"flex",flexDirection:"column"}},s.id))})}function F({params:r}){return e.jsx(h,{direction:"row",alignItems:"center",sx:{py:2,width:1},children:e.jsx(n,{disableTypography:!0,primary:e.jsx(c,{component:"div",sx:{typography:"body2",color:"text.disabled"},children:r.row.userDetails.name})})})}const x=[{value:"approved",label:"Approved"},{value:"draft",label:"Draft"}],J={category:!1},K=["category","actions"];function re(){const{user:r}=L(),[s,y]=l.useState(!1),{enqueueSnackbar:g}=G(),v=N(),{orders:o,ordersLoading:b}=P(),[m,d]=l.useState([]),[C,j]=l.useState(J);l.useEffect(()=>{r!=null&&r.role&&y(M(r==null?void 0:r.role))},[r==null?void 0:r.role]),l.useEffect(()=>{if(o&&o.length>0)if(s)d(o);else{const t=o.filter(a=>(a==null?void 0:a.approved)===!0);d(t)}},[o,s]);const w=async t=>{const a=await B(t);if(a.results.success){const A=m.map(p=>p.id===a.results.result.id?{...p,approved:a.results.result.approved}:p);d(A),g("Approve success!")}else console.error("Approve not success!")},S=t=>s?[e.jsx(U,{showInMenu:!0,icon:e.jsx(k,{icon:"eva:checkmark-circle-2-fill"}),label:"Approve",onClick:()=>w(t.row.id)})]:[],u=[{field:"name",headerName:i("Client"),flex:1,minWidth:140,hideable:!1,renderCell:t=>e.jsx(F,{params:t})},{field:"orders",headerName:i("Orders"),minWidth:140,renderCell:t=>e.jsx(q,{params:t})},{field:"price",headerName:i("Price"),minWidth:140,renderCell:t=>e.jsx(_,{params:t})},{field:"gravestone",headerName:i("Gravestone"),width:110,type:"singleSelect",editable:!0,valueOptions:x,renderCell:t=>e.jsx(V,{params:t})},{field:"approve",headerName:i("Approve"),width:110,type:"singleSelect",editable:!0,valueOptions:x,renderCell:t=>e.jsx(z,{params:t})},{type:"actions",field:"actions",headerName:" ",align:"right",headerAlign:"right",width:80,sortable:!1,filterable:!1,disableColumnMenu:!0,getActions:t=>S(t)}],D=()=>u.filter(t=>!K.includes(t.field)).map(t=>t.field);return e.jsxs(R,{maxWidth:v.themeStretch?!1:"lg",sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(I,{heading:i("List"),links:[{name:i("Order"),href:T.dashboard.root},{name:i("List")}],sx:{mb:{xs:3,md:5}}}),e.jsx(E,{sx:{height:{xs:800,md:2},px:3,flexGrow:{md:1},display:{md:"flex"},flexDirection:{md:"column"}},children:o&&e.jsx(H,{disableRowSelectionOnClick:!0,rows:m,columns:u,loading:b,getRowHeight:()=>"auto",pageSizeOptions:[5,10,25],initialState:{pagination:{paginationModel:{pageSize:10}}},columnVisibilityModel:C,onColumnVisibilityModelChange:t=>j(t),slots:{noRowsOverlay:()=>e.jsx(f,{title:"No Data"}),noResultsOverlay:()=>e.jsx(f,{title:"No results found"})},slotProps:{columnsPanel:{getTogglableColumns:D}}})})]})}export{re as O};
