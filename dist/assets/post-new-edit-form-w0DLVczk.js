import{j as e,a1 as G,T as r,J as M,i as O,Q as W,V as N,C as I,S as b,k as J,aH as Q,y as X,b as _,c as Y,d as j,eb as Z,dS as k,r as t,e as P,o as ee,p as se,X as o,F as ae,D as F,O as T,f as u,dW as E}from"./index-Ai7WBed9.js";import{R as ie}from"./rhf-upload-tFLwhc-m.js";import{R as le}from"./rhf-editor-_vcOeIl1.js";import{R}from"./rhf-autocomplete-InTZEdnt.js";import{M as te}from"./markdown-bZYv6_ix.js";import{E as re}from"./empty-content-UxxF0rT4.js";import{P as ne}from"./post-details-hero-YHmGTXKF.js";import{D as oe}from"./DialogActions-h-2z-LTc.js";import{F as U}from"./FormControlLabel-T6TgLX-i.js";import{S as q}from"./Switch-NjMVebH_.js";import{C as H}from"./Chip-ZcR-KSZs.js";function de({title:s,coverUrl:p,content:l,description:v,open:d,isValid:g,onClose:c,onSubmit:f,isSubmitting:h}){const y=s||v||l||p,m=s||p;return e.jsxs(G,{fullScreen:!0,open:d,onClose:c,children:[e.jsxs(oe,{sx:{py:2,px:3},children:[e.jsx(r,{variant:"h6",sx:{flexGrow:1},children:"Preview"}),e.jsx(M,{variant:"outlined",color:"inherit",onClick:c,children:"Cancel"}),e.jsx(O,{type:"submit",variant:"contained",disabled:!g,loading:h,onClick:f,children:"Post"})]}),e.jsx(W,{}),y?e.jsxs(N,{children:[m&&e.jsx(ne,{title:s,coverUrl:p}),e.jsx(I,{sx:{mt:5,mb:10},children:e.jsxs(b,{sx:{maxWidth:720,mx:"auto"},children:[e.jsx(r,{variant:"h6",sx:{mb:5},children:v}),e.jsx(te,{children:l})]})})]}):e.jsx(re,{filled:!0,title:"Empty Content!"})]})}function ye({currentPost:s}){var S;const p=J(),l=Q("up","md"),{enqueueSnackbar:v}=X(),d=_(),g=Y().shape({title:j().required("Title is required"),description:j().required("Description is required"),content:j().required("Content is required"),coverUrl:Z().nullable().required("Cover is required"),tags:k().min(2,"Must have at least 2 tags"),metaKeywords:k().min(1,"Meta keywords is required"),metaTitle:j(),metaDescription:j()}),c=t.useMemo(()=>({title:(s==null?void 0:s.title)||"",description:(s==null?void 0:s.description)||"",content:(s==null?void 0:s.content)||"",coverUrl:(s==null?void 0:s.coverUrl)||null,tags:(s==null?void 0:s.tags)||[],metaKeywords:(s==null?void 0:s.metaKeywords)||[],metaTitle:(s==null?void 0:s.metaTitle)||"",metaDescription:(s==null?void 0:s.metaDescription)||""}),[s]),f=P({resolver:ee(g),defaultValues:c}),{reset:h,watch:y,setValue:m,handleSubmit:A,formState:{isSubmitting:w,isValid:L}}=f,x=y();t.useEffect(()=>{s&&h(c)},[s,c,h]);const D=A(async a=>{try{await new Promise(i=>setTimeout(i,500)),h(),d.onFalse(),v(s?"Update success!":"Create success!"),p.push(se.dashboard.post.root),console.info("DATA",a)}catch(i){console.error(i)}}),z=t.useCallback(a=>{const i=a[0],n=Object.assign(i,{preview:URL.createObjectURL(i)});i&&m("coverUrl",n,{shouldValidate:!0})},[m]),K=t.useCallback(()=>{m("coverUrl",null)},[m]),V=e.jsxs(e.Fragment,{children:[l&&e.jsxs(o,{md:4,children:[e.jsx(r,{variant:"h6",sx:{mb:.5},children:"Details"}),e.jsx(r,{variant:"body2",sx:{color:"text.secondary"},children:"Title, short description, image..."})]}),e.jsx(o,{xs:12,md:8,children:e.jsxs(F,{children:[!l&&e.jsx(T,{title:"Details"}),e.jsxs(b,{spacing:3,sx:{p:3},children:[e.jsx(u,{name:"title",label:"Post Title"}),e.jsx(u,{name:"description",label:"Description",multiline:!0,rows:3}),e.jsxs(b,{spacing:1.5,children:[e.jsx(r,{variant:"subtitle2",children:"Content"}),e.jsx(le,{simple:!0,name:"content"})]}),e.jsxs(b,{spacing:1.5,children:[e.jsx(r,{variant:"subtitle2",children:"Cover"}),e.jsx(ie,{name:"coverUrl",maxSize:3145728,onDrop:z,onDelete:K})]})]})]})})]}),$=e.jsxs(e.Fragment,{children:[l&&e.jsxs(o,{md:4,children:[e.jsx(r,{variant:"h6",sx:{mb:.5},children:"Properties"}),e.jsx(r,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(o,{xs:12,md:8,children:e.jsxs(F,{children:[!l&&e.jsx(T,{title:"Properties"}),e.jsxs(b,{spacing:3,sx:{p:3},children:[e.jsx(R,{name:"tags",label:"Tags",placeholder:"+ Tags",multiple:!0,freeSolo:!0,options:E.map(a=>a),getOptionLabel:a=>a,renderOption:(a,i)=>t.createElement("li",{...a,key:i},i),renderTags:(a,i)=>a.map((n,C)=>t.createElement(H,{...i({index:C}),key:n,label:n,size:"small",color:"info",variant:"soft"}))}),e.jsx(u,{name:"metaTitle",label:"Meta title"}),e.jsx(u,{name:"metaDescription",label:"Meta description",fullWidth:!0,multiline:!0,rows:3}),e.jsx(R,{name:"metaKeywords",label:"Meta keywords",placeholder:"+ Keywords",multiple:!0,freeSolo:!0,disableCloseOnSelect:!0,options:E.map(a=>a),getOptionLabel:a=>a,renderOption:(a,i)=>t.createElement("li",{...a,key:i},i),renderTags:(a,i)=>a.map((n,C)=>t.createElement(H,{...i({index:C}),key:n,label:n,size:"small",color:"info",variant:"soft"}))}),e.jsx(U,{control:e.jsx(q,{defaultChecked:!0}),label:"Enable comments"})]})]})})]}),B=e.jsxs(e.Fragment,{children:[l&&e.jsx(o,{md:4}),e.jsxs(o,{xs:12,md:8,sx:{display:"flex",alignItems:"center"},children:[e.jsx(U,{control:e.jsx(q,{defaultChecked:!0}),label:"Publish",sx:{flexGrow:1,pl:3}}),e.jsx(M,{color:"inherit",variant:"outlined",size:"large",onClick:d.onTrue,children:"Preview"}),e.jsx(O,{type:"submit",variant:"contained",size:"large",loading:w,sx:{ml:2},children:s?"Save Changes":"Create Post"})]})]});return e.jsxs(ae,{methods:f,onSubmit:D,children:[e.jsxs(o,{container:!0,spacing:3,children:[V,$,B]}),e.jsx(de,{title:x.title,content:x.content,description:x.description,coverUrl:typeof x.coverUrl=="string"?x.coverUrl:`${(S=x.coverUrl)==null?void 0:S.preview}`,open:d.value,isValid:L,isSubmitting:w,onClose:d.onFalse,onSubmit:D})]})}export{ye as P};
