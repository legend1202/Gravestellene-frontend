import{Z as z,r as p,k as B,u as O,c as K,d as r,bs as Z,e as J,o as Q,p as W,j as s,M as j,K as L,ai as q,S as g,f as v,T as F,v as X,i as Y,F as u,A as P}from"./index-HKvYvq3j.js";import{c as ee,d as se,e as ae}from"./graveyard-zrdqr7Mr.js";import{R as ie}from"./rhf-upload-oxFbTyHB.js";import{R as le}from"./rhf-editor-MyWMJ1ag.js";function xe({currentProduct:e}){const{enqueueSnackbar:w}=z(),[k,b]=p.useState(""),S=B(),[n,h]=p.useState([]),{t:l}=O(),C=K().shape({name:r().required("Name is required"),location:r().required("Location is required"),picture:Z().min(1,"Images is required"),content:r().required("Content is required"),newsLink:r().required("News is required"),forecastLink:r().required("Forecast is required")}),y=p.useMemo(()=>({name:(e==null?void 0:e.name)||"",location:(e==null?void 0:e.location)||"",picture:(e==null?void 0:e.picture)||[],content:(e==null?void 0:e.content)||"",newsLink:(e==null?void 0:e.newsLink)||"",forecastLink:(e==null?void 0:e.forecastLink)||""}),[e]),R=J({resolver:Q(C),defaultValues:y}),{reset:d,watch:G,setValue:m,handleSubmit:U,formState:{isSubmitting:E}}=R,t=G();p.useEffect(()=>{e&&(h(e.picture),d(y))},[e,y,d]);const D=U(async x=>{var c,o;try{if(e){const i={...e,...t,picture:n},a=await ee(i);(c=a.searchResults)!=null&&c.success?(d(),w("Update success!")):b(a==null?void 0:a.message)}else{const i={...t,picture:n},a=await se(i);(o=a.searchResults)!=null&&o.success?(d(),w("Create success!")):b(a==null?void 0:a.message)}S.push(W.fellesraad.graveyard.list)}catch(i){b(i==null?void 0:i.message),console.error(i)}}),N=p.useCallback(async x=>{const c=t.picture||[],o=x.map(f=>Object.assign(f,{preview:URL.createObjectURL(f)})),i=await ae(x),a=[...n,i];e!=null&&e.picture?h([...e.picture,...a]):h([...a]),m("picture",[...c,...o],{shouldValidate:!0})},[m,t.picture,n,e==null?void 0:e.picture]),A=p.useCallback(x=>{var o,i;const c=t.picture&&((o=t.picture)==null?void 0:o.filter(a=>a!==x));(i=t.picture)==null||i.forEach((a,f)=>{if(a===x){const V=n==null?void 0:n.filter((ne,$)=>f!==$);h(V)}}),m("picture",c)},[m,t.picture,n]),T=p.useCallback(()=>{m("picture",[]),h([])},[m]),_=async()=>{console.log("")},H=s.jsx(j,{xs:12,md:12,children:s.jsxs(L,{children:[s.jsx(q,{title:l("Details")}),s.jsxs(g,{spacing:3,sx:{p:3},children:[s.jsx(v,{name:"name",label:l("Graveyard_Name")}),s.jsx(v,{name:"location",label:l("Graveyard_Location")}),s.jsxs(g,{spacing:1.5,children:[s.jsx(F,{variant:"subtitle2",children:l("Content")}),s.jsx(le,{simple:!0,name:"content"})]}),s.jsxs(g,{spacing:1.5,children:[s.jsx(F,{variant:"subtitle2",children:l("Pictures")}),s.jsx(ie,{multiple:!0,thumbnail:!0,name:"picture",maxSize:13145728,onDrop:N,onRemove:A,onRemoveAll:T,onUpload:_})]})]})]})}),M=s.jsx(j,{xs:12,md:12,children:s.jsxs(L,{children:[s.jsx(q,{title:l("Properties")}),s.jsx(g,{spacing:3,sx:{p:3},children:s.jsxs(X,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(1, 1fr)"},children:[s.jsx(v,{name:"newsLink",label:l("News")}),s.jsx(v,{name:"forecastLink",label:l("Forecast")})]})})]})}),I=s.jsx(j,{xs:12,md:12,sx:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:s.jsx(Y,{type:"submit",variant:"contained",size:"large",loading:E,children:l(e?"save_changes":"create_product")})});return s.jsx(u,{methods:R,onSubmit:D,children:s.jsxs(j,{container:!0,spacing:3,children:[!!k&&s.jsx(P,{severity:"error",sx:{mb:3},children:k}),H,M,I]})})}export{xe as G};
