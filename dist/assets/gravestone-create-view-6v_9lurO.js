import{aj as $,j as a,ak as U,ex as z,c8 as H,X,S as l,T as F,u as N,b2 as P,s as K,I as Y,h as Z,n as J,D as Q,Z as v,ek as G,r as u,G as ee,b as ae,c as se,d as f,e as ie,o as de,f as t,M as te,i as le,F as oe,C as re,K as ne}from"./index-F58UWM6d.js";import{E as ce}from"./empty-content-cu3d-hY6.js";import{b as he}from"./graveyard-fuRNBAw2.js";import{c as me}from"./gravestone-gi_0JvRh.js";import{f as S}from"./format-time-N0vllXDz.js";import{D as xe}from"./DatePicker-k9SVsDE2.js";import{f as be}from"./index-vAlubGkb.js";import{S as w}from"./Skeleton-UqJgurFx.js";function I({name:e,label:s,defaultValue:d}){const{control:i}=$();return a.jsx(U,{name:e,control:i,render:({field:c,fieldState:{error:o}})=>a.jsx(xe,{label:s,value:z(d),onChange:h=>{c.onChange(h)},slotProps:{textField:{fullWidth:!0,error:!!o,helperText:o==null?void 0:o.message}}})})}function pe({mail:e,selected:s,sx:d,...i}){if(e.approved)return a.jsxs(H,{sx:{p:1,mb:.5,borderRadius:1,...s&&{bgcolor:"action.selected"},...d},...i,children:[a.jsx(X,{primary:e.name,primaryTypographyProps:{noWrap:!0,variant:"subtitle2"},secondary:e.location,secondaryTypographyProps:{noWrap:!0,component:"span",variant:"body2",color:"text.secondary"}}),a.jsx(l,{alignItems:"flex-end",sx:{ml:2,height:44},children:a.jsx(F,{noWrap:!0,variant:"body2",component:"span",sx:{mb:1.5,fontSize:12,color:"text.disabled"},children:e.cratedAt&&be(new Date(e.cratedAt),{addSuffix:!1})})})]})}function ue({sx:e,...s}){return a.jsxs(l,{spacing:2,direction:"row",alignItems:"center",sx:{py:1,...e},...s,children:[a.jsx(w,{variant:"circular",sx:{width:40,height:40}}),a.jsxs(l,{spacing:1,flexGrow:1,children:[a.jsx(w,{sx:{width:.75,height:10}}),a.jsx(w,{sx:{width:.5,height:10}})]})]})}function fe({loading:e,mails:s,openMail:d,onCloseMail:i,onClickMail:c,selectedLabelId:o,selectedMailId:h}){const{t:m}=N(),x=P("up","md"),g=a.jsx(a.Fragment,{children:[...Array(8)].map((r,p)=>a.jsx(ue,{},p))}),j=a.jsx(a.Fragment,{children:s&&s.map((r,p)=>a.jsx(pe,{mail:r,selected:h===r.id,onClick:()=>{c(r.id)}},p))}),b=a.jsxs(a.Fragment,{children:[a.jsx(l,{sx:{p:2},children:a.jsx(K,{placeholder:m("search"),InputProps:{startAdornment:a.jsx(Y,{position:"start",children:a.jsx(Z,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})}),a.jsxs(J,{sx:{px:2},children:[e&&g,s&&!!s.length&&j]})]});return x?a.jsx(l,{sx:{width:320,flexShrink:0,borderRadius:1.5,bgcolor:"background.default"},children:b}):a.jsx(Q,{open:d,onClose:i,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:320}},children:b})}const ge="inbox";function Fe({currentGravestone:e}){const{t:s}=N(),{enqueueSnackbar:d}=v(),{graveyards:i,graveyardsLoading:c}=he(),h=G().get("label")||ge,[m,x]=u.useState(""),g=P("up","md"),j=ee(),b=ae(),r=se().shape({firstName:f().required("name is required"),lastName:f().required("name is required"),birthday:f().required("birthday is required"),deceasedDate:f().required("deceasedDate is required"),buriedDate:f().required("buriedDate is required")}),p=u.useMemo(()=>({graveyardId:e?e.graveyardId:"",firstName:e?e.firstName:"",lastName:e?e.lastName:"",birthday:e?e.birthday:"",deceasedDate:e?e.deceasedDate:"",buriedDate:e?e.buriedDate:"",ageOnDeath:e?e.ageOnDeath:"",churchNumber:e?e.churchNumber:"",field:e?e.field:"",row:e?e.row:"",place:e?e.place:"",burriedWith:e?e.burriedWith:"",bio:e?e.bio:""}),[e]),C=ie({resolver:de(r),defaultValues:p}),{reset:M,watch:q,handleSubmit:L,formState:{isSubmitting:_}}=C,n=q(),R=u.useCallback(k=>{x(k)},[]);u.useEffect(()=>{i&&i.length>0&&i[0].id&&x(i[0].id)},[i]),u.useEffect(()=>{e&&x(e.graveyardId)},[e]);const T=L(async k=>{try{if(m){const y=S(n.birthday),B=S(n.buriedDate),O=S(n.deceasedDate),V={...n,birthday:y,buriedDate:B,deceasedDate:O,graveyardId:m,name:`${n.firstName} ${n.lastName}`},D=await me(V);D!=null&&D.searchResults.success,d(s(e?"update_success":"create_success")),M()}else d("Select the Graveyard!")}catch(y){console.error(y)}}),E=a.jsx(fe,{mails:i,loading:c,openMail:b.value,onCloseMail:b.onFalse,onClickMail:R,selectedLabelId:h,selectedMailId:m}),W=a.jsx(a.Fragment,{children:i?a.jsxs(l,{spacing:3,sx:{p:1,flex:1,justifyContent:"space-between",overflowY:"scroll"},children:[a.jsx(t,{name:"firstName",label:s("Fornavn")}),a.jsx(t,{name:"lastName",label:s("Etternavn")}),a.jsx(I,{name:"birthday",label:s("Birthday"),defaultValue:(e==null?void 0:e.birthday)||"05/10/2024"}),a.jsx(I,{name:"deceasedDate",label:s("deceased_date"),defaultValue:(e==null?void 0:e.deceasedDate)||"05/10/2024"}),a.jsx(I,{name:"buriedDate",label:s("buried_date"),defaultValue:(e==null?void 0:e.buriedDate)||"05/10/2024"}),a.jsx(t,{name:"ageOnDeath",label:s("Age On Death")}),a.jsx(t,{name:"churchNumber",label:s("Church Number")}),a.jsx(t,{name:"field",label:s("Field")}),a.jsx(t,{name:"row",label:s("Row")}),a.jsx(t,{name:"place",label:s("Place")}),a.jsx(t,{name:"burriedWith",label:s("Buried With")}),a.jsx(t,{name:"bio",label:s("bio")})]}):a.jsx(ce,{imgUrl:"/assets/icons/empty/ic_email_disabled.svg",sx:{borderRadius:1.5,bgcolor:"background.default",...!g&&{display:"none"}}})}),A=a.jsx(te,{xs:12,md:12,sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",p:1},children:a.jsx(le,{type:"submit",variant:"contained",size:"large",loading:_,children:e?"Save Changes":s("create_product")})});return a.jsx(oe,{methods:C,onSubmit:T,children:a.jsxs(re,{maxWidth:j.themeStretch?!1:"xl",children:[a.jsx(F,{variant:"h4",sx:{mb:{xs:3,md:5}},children:s("Gravestone")}),a.jsxs(l,{spacing:1,sx:{p:1,borderRadius:2,overflow:"hidden",position:"relative",bgcolor:"background.neutral"},children:[a.jsxs(l,{component:ne,direction:"row",sx:{height:"72vh"},children:[E,W]}),A]})]})})}export{Fe as G};
