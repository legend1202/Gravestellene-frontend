import{j as e,Y as n,v as c,x as O,S as h,u as G,r as l,_ as L,G as N,a0 as a,C as R,J as I,p as T,K as E,g as k}from"./index-N8SydwAL.js";import{i as M}from"./role-check-5Hlc5mGT.js";import{G as P,A as W}from"./order-R7QOarOU.js";import{E as f}from"./empty-content-Ttp3qqTd.js";import{f as _}from"./format-number-wF8MOw5S.js";import{D as B}from"./DataGrid-hc9we__K.js";import{G as H}from"./GridActionsCellItem-YhCfvTdB.js";function U({params:r}){return e.jsx(e.Fragment,{children:r.row.serviceDetails.map(s=>e.jsx(n,{disableTypography:!0,primary:e.jsx(c,{component:"div",sx:{typography:"body2",color:"text.disabled"},children:_(s.price)}),sx:{display:"flex",flexDirection:"column"}},s.id))})}function V({params:r}){return e.jsx(O,{variant:"soft",color:r.row.approved&&"info"||"default",children:r.row.approved?"Approved":"Draft"})}function z({params:r}){return e.jsx(n,{primary:r.row.gravestoneDetails.graveSite,primaryTypographyProps:{typography:"body2",noWrap:!0}})}function F({params:r}){return e.jsx(h,{direction:"row",alignItems:"center",sx:{py:2,width:1},children:r.row.serviceDetails.map(s=>e.jsx(n,{disableTypography:!0,primary:e.jsx(c,{component:"div",sx:{typography:"body2",color:"text.disabled"},children:s.name}),sx:{display:"flex",flexDirection:"column"}},s.id))})}function q({params:r}){return e.jsx(h,{direction:"row",alignItems:"center",sx:{py:2,width:1},children:e.jsx(n,{disableTypography:!0,primary:e.jsx(c,{component:"div",sx:{typography:"body2",color:"text.disabled"},children:r.row.userDetails.name})})})}const x=[{value:"approved",label:"Approved"},{value:"draft",label:"Draft"}],J={category:!1},K=["category","actions"];function re(){const{user:r}=G(),[s,y]=l.useState(!1),{enqueueSnackbar:g}=L(),v=N(),{orders:o,ordersLoading:b}=P(),[m,d]=l.useState([]),[C,j]=l.useState(J);l.useEffect(()=>{r!=null&&r.role&&y(M(r==null?void 0:r.role))},[r==null?void 0:r.role]),l.useEffect(()=>{if(o&&o.length>0)if(s)d(o);else{const t=o.filter(i=>(i==null?void 0:i.approved)===!0);d(t)}},[o,s]);const S=async t=>{const i=await W(t);if(i.results.success){const D=m.map(p=>p.id===i.results.result.id?{...p,approved:i.results.result.approved}:p);d(D),g("Approve success!")}else console.error("Approve not success!")},w=t=>s?[e.jsx(H,{showInMenu:!0,icon:e.jsx(k,{icon:"eva:checkmark-circle-2-fill"}),label:"Approve",onClick:()=>S(t.row.id)})]:[],u=[{field:"name",headerName:a("Client"),flex:1,minWidth:140,hideable:!1,renderCell:t=>e.jsx(q,{params:t})},{field:"orders",headerName:a("Orders"),minWidth:140,renderCell:t=>e.jsx(F,{params:t})},{field:"price",headerName:a("Price"),minWidth:140,renderCell:t=>e.jsx(U,{params:t})},{field:"gravestone",headerName:a("Gravestone"),width:110,type:"singleSelect",editable:!0,valueOptions:x,renderCell:t=>e.jsx(z,{params:t})},{field:"approve",headerName:a("Approve"),width:110,type:"singleSelect",editable:!0,valueOptions:x,renderCell:t=>e.jsx(V,{params:t})},{type:"actions",field:"actions",headerName:" ",align:"right",headerAlign:"right",width:80,sortable:!1,filterable:!1,disableColumnMenu:!0,getActions:t=>w(t)}],A=()=>u.filter(t=>!K.includes(t.field)).map(t=>t.field);return e.jsxs(R,{maxWidth:v.themeStretch?!1:"lg",sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(I,{heading:a("List"),links:[{name:a("Order"),href:T.dashboard.root},{name:a("List")}],sx:{mb:{xs:3,md:5}}}),e.jsx(E,{sx:{height:{xs:800,md:2},px:3,flexGrow:{md:1},display:{md:"flex"},flexDirection:{md:"column"}},children:o&&e.jsx(B,{disableRowSelectionOnClick:!0,rows:m,columns:u,loading:b,getRowHeight:()=>"auto",pageSizeOptions:[5,10,25],initialState:{pagination:{paginationModel:{pageSize:10}}},columnVisibilityModel:C,onColumnVisibilityModelChange:t=>j(t),slots:{noRowsOverlay:()=>e.jsx(f,{title:"No Data"}),noResultsOverlay:()=>e.jsx(f,{title:"No results found"})},slotProps:{columnsPanel:{getTogglableColumns:A}}})})]})}export{re as O};
