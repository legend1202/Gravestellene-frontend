import{_ as V,r as l,M as k,a as $,G as U,a1 as Q,a5 as J,c as K,b as X,d as Y,o as Z,j as s,C as ee,J as se,p as L,B as D,R as te,g as y,F as ae,a6 as re,K as ie,S as le,a7 as oe,a8 as ne,u as de,H as ce}from"./index-N8SydwAL.js";import{a as me,b as pe}from"./role-check-5Hlc5mGT.js";import{b as ue}from"./graveyard-vLLPM793.js";import{E as N}from"./empty-content-Ttp3qqTd.js";import{R as fe}from"./rhf-select-Y9ddv89c.js";import{R as he,a as xe,b as ve,d as ge,e as ye}from"./graveyard-table-row-w80u_KdY.js";import{D as Ce}from"./DataGrid-hc9we__K.js";import{G as be,a as we}from"./GridToolbarQuickFilter-7gGSvQkk.js";import{G as P}from"./GridActionsCellItem-YhCfvTdB.js";import"./Checkbox-aend9-0B.js";import"./SwitchBase-GkPf3Zwx.js";import"./Chip-YnHBPfwg.js";import"./format-number-wF8MOw5S.js";import"./index-dPzt3bTj.js";import"./Autocomplete-pOUHWdGk.js";import"./ClickAwayListener-cYULqw4X.js";import"./Switch--DTMlivf.js";import"./Skeleton-505Etpy4.js";import"./TablePagination-w-y8Ao-s.js";import"./FirstPage-S57-CWai.js";import"./TableCell-KZJaRtgc.js";import"./FormControlLabel-kJYRDF2M.js";const Se=async(t,o)=>{const f=t.filter(a=>a.approved).map(async a=>{const h=o.filter(i=>i.serviceId===a.id).map(i=>{var x;const n=(x=i==null?void 0:i.graveyardDetails)==null?void 0:x.name;return i!=null&&i.approved?{...a,graveyardName:n,rapproved:!0}:{...a,graveyardName:n,rapproved:!1}});return h.length===0?a:h});return(await Promise.all(f)).flat()},je=async t=>{const o=t.map(async r=>({id:r.id,rapproved:r.approved,name:r.serviceDetails.name,unit:r.serviceDetails.unit,price:r.serviceDetails.price,graveyardName:r.graveyardDetails.name,description:r.serviceDetails.description}));return(await Promise.all(o)).flat()},M=[{value:"published",label:"Published"},{value:"draft",label:"Draft"}],Re={category:!1},Ge=["category","actions"];function Ie({user:t}){const{enqueueSnackbar:o}=V(),[u,f]=l.useState(!1),[r,C]=l.useState(!1),{t:a}=k(),h=$(),i=U(),{services:n,servicesLoading:x}=Q(t==null?void 0:t.userId),{rservices:p}=J(t==null?void 0:t.userId),{graveyards:b}=ue(),[v,w]=l.useState([]),[j,q]=l.useState([]),[A,F]=l.useState(Re),O=K().shape({id:X().required("Please select Graveyard!")}),E=l.useMemo(()=>({id:""}),[]),R=Y({resolver:Z(O),defaultValues:E}),{watch:_}=R,d=_();l.useEffect(()=>{t!=null&&t.role&&(f(me(t==null?void 0:t.role)),C(pe(t==null?void 0:t.role)))},[t==null?void 0:t.role]);const G=l.useCallback(async()=>{if(n&&n.length>0&&!r){const e=await Se(n,p);w(e)}if(r){const e=await je(p);w(e)}},[n,r,p]);l.useEffect(()=>{p&&G()},[p,G]);const B=async e=>{var c,g;try{const m=b.filter(S=>(S==null?void 0:S.id)===d.id);d!=null&&d.id||console.error("Select Graveyard!");const z={fellesraadId:((c=m[0])==null?void 0:c.fellesraadId)||"",graveyardId:(d==null?void 0:d.id)||"",serviceId:e||"",companyId:(t==null?void 0:t.userId)||""};(g=(await oe(z)).searchResults)!=null&&g.success&&o("Service request success!")}catch{window.prompt("Please select the Graveyard!")}},T=async e=>{const c=await ne(e);if(c.searchResults.success){const g=v.map(m=>m.id===c.searchResults.result.id?{...m,rapproved:c.searchResults.result.approved}:m);w(g),o("Approve success!")}else console.error("Approve not success!")},H=e=>r?[s.jsx(P,{showInMenu:!0,icon:s.jsx(y,{icon:"eva:checkmark-circle-2-fill"}),label:"Approve",onClick:()=>T(e.row.id)})]:u&&!("rapproved"in e.row)?[s.jsx(P,{showInMenu:!0,icon:s.jsx(y,{icon:"solar:trash-bin-trash-bold"}),label:a("Request"),onClick:()=>B(e.row.id)})]:[],I=[{field:"name",headerName:a("service_name"),flex:1,minWidth:100,hideable:!1,renderCell:e=>s.jsx(he,{params:e})},{field:"description",headerName:a("description"),minWidth:280,renderCell:e=>s.jsx(xe,{params:e})},{field:"price",headerName:a("price"),minWidth:110,renderCell:e=>s.jsx(ve,{params:e})},{field:"Graveyard",headerName:a("Graveyard"),width:280,type:"singleSelect",editable:!0,valueOptions:M,renderCell:e=>s.jsx(ge,{params:e})},{field:"Approve",headerName:a("Approve"),width:110,type:"singleSelect",editable:!0,valueOptions:M,renderCell:e=>s.jsx(ye,{params:e})},{type:"actions",field:"actions",headerName:" ",align:"right",headerAlign:"right",width:80,sortable:!1,filterable:!1,disableColumnMenu:!0,getActions:e=>H(e)}],W=()=>I.filter(e=>!Ge.includes(e.field)).map(e=>e.field);return s.jsxs(ee,{maxWidth:i.themeStretch?!1:"lg",sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[s.jsx(se,{heading:a("List"),links:[{name:a("service"),href:L.fellesraad.service.root},{name:a("List")}],action:u&&s.jsx(D,{component:te,href:L.fellesraad.service.create,variant:"contained",startIcon:s.jsx(y,{icon:"mingcute:add-line"}),children:a("new_service")}),sx:{mb:{xs:3,md:5}}}),b&&!r&&s.jsx(ae,{methods:R,children:s.jsx(fe,{fullWidth:!0,name:"id",label:a("Graveyard"),InputLabelProps:{shrink:!0},PaperPropsSx:{textTransform:"capitalize"},sx:{mb:1},children:b.map(e=>(e==null?void 0:e.approved)&&s.jsx(re,{value:e==null?void 0:e.id,children:e==null?void 0:e.name},e.id))})}),s.jsx(ie,{sx:{height:{xs:800,md:2},flexGrow:{md:1},display:{md:"flex"},flexDirection:{md:"column"},px:3},children:v&&v.length>0&&s.jsx(Ce,{disableRowSelectionOnClick:!0,rows:v,columns:I,loading:x,getRowHeight:()=>"auto",pageSizeOptions:[5,10,25],initialState:{pagination:{paginationModel:{pageSize:10}}},onRowSelectionModelChange:e=>{q(e)},columnVisibilityModel:A,onColumnVisibilityModelChange:e=>F(e),slots:{toolbar:()=>s.jsxs(be,{children:[s.jsx(we,{}),s.jsx(le,{spacing:1,flexGrow:1,direction:"row",alignItems:"center",justifyContent:"flex-end",children:!!j.length&&s.jsxs(D,{size:"small",color:"error",startIcon:s.jsx(y,{icon:"solar:trash-bin-trash-bold"}),onClick:h.onTrue,children:["Delete (",j.length,")"]})})]}),noRowsOverlay:()=>s.jsx(N,{title:"No Data"}),noResultsOverlay:()=>s.jsx(N,{title:"No results found"})},slotProps:{columnsPanel:{getTogglableColumns:W}}})})]})}function Xe(){const{t}=k(),{user:o}=de();return s.jsxs(s.Fragment,{children:[s.jsx(ce,{children:s.jsxs("title",{children:[" ",`${t("services")}: ${t("list_of_services")}`]})}),s.jsx(Ie,{user:o})]})}export{Xe as default};
