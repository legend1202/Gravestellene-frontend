import{m as $,r as t,e as z,p as O,j as s,G as d,S as j,T as k,B as _}from"./index-UlQdJV1P.js";import{c as J,a as f,e as K}from"./index.esm-cAEu_E74.js";import{u as Q,F as W}from"./form-provider-8dyUY3gl.js";import{o as X}from"./yup-Th0LEyqb.js";import{a as Y,c as Z,b as u}from"./graveyard-KG1nYXXt.js";import{R as P}from"./rhf-upload-A1alQ536.js";import"./mui-one-time-password-input.es-0dNzvKac.js";import{R as ee}from"./rhf-editor-ifkf46Xc.js";import{R as g}from"./rhf-text-field-aU6tRkgd.js";import{A as se}from"./Alert-KuTKY0IR.js";import{C}from"./Card-Tpk2mypx.js";import{C as L}from"./CardHeader-SgRebtzA.js";import{L as ae}from"./LoadingButton-HxvkKaQJ.js";function ge({currentProduct:e}){const{enqueueSnackbar:y}=$(),[w,b]=t.useState(""),S=z(),[l,x]=t.useState([]),q=J().shape({name:f().required("Name is required"),location:f().required("Location is required"),picture:K().min(1,"Images is required"),content:f().required("Content is required"),newsLink:f().required("News is required"),forecastLink:f().required("Forecast is required")}),v=t.useMemo(()=>({name:(e==null?void 0:e.name)||"",location:(e==null?void 0:e.location)||"",picture:(e==null?void 0:e.picture)||[],content:(e==null?void 0:e.content)||"",newsLink:(e==null?void 0:e.newsLink)||"",forecastLink:(e==null?void 0:e.forecastLink)||""}),[e]),R=Q({resolver:X(q),defaultValues:v}),{reset:h,watch:F,setValue:m,handleSubmit:G,formState:{isSubmitting:U}}=R,n=F();t.useEffect(()=>{e&&(x(e.picture),h(v))},[e,v,h]);const E=G(async p=>{var r,o;try{if(e){const i={...e,...n,picture:l},a=await Y(i);(r=a.searchResults)!=null&&r.success?(h(),y("Update success!")):b(a==null?void 0:a.message)}else{const i={...n,picture:l},a=await Z(i);(o=a.searchResults)!=null&&o.success?(h(),y("Create success!")):b(a==null?void 0:a.message)}S.push(O.fellesraad.graveyard.list)}catch(i){b(i==null?void 0:i.message),console.error(i)}}),D=t.useCallback(async p=>{const r=n.picture||[],o=p.map(c=>Object.assign(c,{preview:URL.createObjectURL(c)})),i=await u(p),a=[...l,i];e!=null&&e.picture?x([...e.picture,...a]):x([...a]),m("picture",[...r,...o],{shouldValidate:!0})},[m,n.picture,l,e==null?void 0:e.picture]),N=t.useCallback(p=>{var o,i;const r=n.picture&&((o=n.picture)==null?void 0:o.filter(a=>a!==p));(i=n.picture)==null||i.forEach((a,c)=>{if(a===p){const M=l==null?void 0:l.filter((ie,V)=>c!==V);x(M)}}),m("picture",r)},[m,n.picture,l]),A=t.useCallback(()=>{m("picture",[]),x([])},[m]),H=async()=>{console.log("")},T=s.jsx(d,{xs:12,md:12,children:s.jsxs(C,{children:[s.jsx(L,{title:"Details"}),s.jsxs(j,{spacing:3,sx:{p:3},children:[s.jsx(g,{name:"name",label:"Graveyard Name"}),s.jsx(g,{name:"location",label:"Graveyard location"}),s.jsxs(j,{spacing:1.5,children:[s.jsx(k,{variant:"subtitle2",children:"Content"}),s.jsx(ee,{simple:!0,name:"content"})]}),s.jsxs(j,{spacing:1.5,children:[s.jsx(k,{variant:"subtitle2",children:"Pictures"}),s.jsx(P,{multiple:!0,thumbnail:!0,name:"picture",maxSize:13145728,onDrop:D,onRemove:N,onRemoveAll:A,onUpload:H})]})]})]})}),B=s.jsx(d,{xs:12,md:12,children:s.jsxs(C,{children:[s.jsx(L,{title:"Properties"}),s.jsx(j,{spacing:3,sx:{p:3},children:s.jsxs(_,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(1, 1fr)"},children:[s.jsx(g,{name:"newsLink",label:"News"}),s.jsx(g,{name:"forecastLink",label:"Forecast"})]})})]})}),I=s.jsx(d,{xs:12,md:12,sx:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:s.jsx(ae,{type:"submit",variant:"contained",size:"large",loading:U,children:e?"Save Changes":"Create Product"})});return s.jsx(W,{methods:R,onSubmit:E,children:s.jsxs(d,{container:!0,spacing:3,children:[!!w&&s.jsx(se,{severity:"error",sx:{mb:3},children:w}),T,B,I]})})}export{ge as G};
