import{e as $,az as G,du as W,r as d,p as B,j as e,G as o,T as t,S as n,ef as J,A as y,cJ as K,eb as Q,dD as X}from"./index-uKP6CWMZ.js";import{c as D,a as c,b as h,f as S}from"./index.esm-IE62FTq2.js";import{R as C,o as Y}from"./rhf-text-field-I12FDcZg.js";import{u as Z,C as F,F as u}from"./form-provider-XaOssykM.js";import{R as T}from"./rhf-upload-iKUGzQ5t.js";import{a as ee}from"./rhf-checkbox-RbGq1kB2.js";import"./mui-one-time-password-input.es-BcSk2K9t.js";import{R as se}from"./rhf-editor-8fNvdcny.js";import{R as b}from"./rhf-autocomplete-0J_UEi-0.js";import{C as R}from"./Card-ZPFmK4Qe.js";import{C as E}from"./CardHeader-Md6rNf6p.js";import{C as k}from"./Chip-fErUxNUa.js";import{D as q}from"./DatePicker-WhWcB-69.js";import{F as ae}from"./FormControlLabel-K7ZxdnHO.js";import{S as ie}from"./Switch-H0reFH8F.js";import{L as te}from"./LoadingButton-A7XVLFYx.js";function De({currentTour:s}){const O=$(),x=G("up","md"),{enqueueSnackbar:A}=W(),w=D().shape({name:c().required("Name is required"),content:c().required("Content is required"),images:h().min(1,"Images is required"),tourGuides:h().min(1,"Must have at least 1 guide"),durations:c().required("Duration is required"),tags:h().min(2,"Must have at least 2 tags"),services:h().min(2,"Must have at least 2 services"),destination:c().required("Destination is required"),available:D().shape({startDate:S().nullable().required("Start date is required"),endDate:S().required("End date is required").test("date-min","End date must be later than start date",(i,{parent:a})=>i.getTime()>a.startDate.getTime())})}),j=d.useMemo(()=>({name:(s==null?void 0:s.name)||"",content:(s==null?void 0:s.content)||"",images:(s==null?void 0:s.images)||[],tourGuides:(s==null?void 0:s.tourGuides)||[],tags:(s==null?void 0:s.tags)||[],durations:(s==null?void 0:s.durations)||"",destination:(s==null?void 0:s.destination)||"",services:(s==null?void 0:s.services)||[],available:{startDate:(s==null?void 0:s.available.startDate)||null,endDate:(s==null?void 0:s.available.endDate)||null}}),[s]),v=Z({resolver:Y(w),defaultValues:j}),{watch:P,reset:g,control:f,setValue:r,handleSubmit:U,formState:{isSubmitting:L}}=v,p=P();d.useEffect(()=>{s&&g(j)},[s,j,g]);const M=U(async i=>{try{await new Promise(a=>setTimeout(a,500)),g(),A(s?"Update success!":"Create success!"),O.push(B.dashboard.tour.root),console.info("DATA",i)}catch(a){console.error(a)}}),H=d.useCallback(i=>{const a=p.images||[],l=i.map(m=>Object.assign(m,{preview:URL.createObjectURL(m)}));r("images",[...a,...l],{shouldValidate:!0})},[r,p.images]),N=d.useCallback(i=>{var l;const a=p.images&&((l=p.images)==null?void 0:l.filter(m=>m!==i));r("images",a)},[r,p.images]),z=d.useCallback(()=>{r("images",[])},[r]),I=e.jsxs(e.Fragment,{children:[x&&e.jsxs(o,{md:4,children:[e.jsx(t,{variant:"h6",sx:{mb:.5},children:"Details"}),e.jsx(t,{variant:"body2",sx:{color:"text.secondary"},children:"Title, short description, image..."})]}),e.jsx(o,{xs:12,md:8,children:e.jsxs(R,{children:[!x&&e.jsx(E,{title:"Details"}),e.jsxs(n,{spacing:3,sx:{p:3},children:[e.jsxs(n,{spacing:1.5,children:[e.jsx(t,{variant:"subtitle2",children:"Name"}),e.jsx(C,{name:"name",placeholder:"Ex: Adventure Seekers Expedition..."})]}),e.jsxs(n,{spacing:1.5,children:[e.jsx(t,{variant:"subtitle2",children:"Content"}),e.jsx(se,{simple:!0,name:"content"})]}),e.jsxs(n,{spacing:1.5,children:[e.jsx(t,{variant:"subtitle2",children:"Images"}),e.jsx(T,{multiple:!0,thumbnail:!0,name:"images",maxSize:3145728,onDrop:H,onRemove:N,onRemoveAll:z,onUpload:()=>console.info("ON UPLOAD")})]})]})]})})]}),V=e.jsxs(e.Fragment,{children:[x&&e.jsxs(o,{md:4,children:[e.jsx(t,{variant:"h6",sx:{mb:.5},children:"Properties"}),e.jsx(t,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(o,{xs:12,md:8,children:e.jsxs(R,{children:[!x&&e.jsx(E,{title:"Properties"}),e.jsxs(n,{spacing:3,sx:{p:3},children:[e.jsxs(n,{children:[e.jsx(t,{variant:"subtitle2",sx:{mb:1.5},children:"Tour Guide"}),e.jsx(b,{multiple:!0,name:"tourGuides",placeholder:"+ Tour Guides",disableCloseOnSelect:!0,options:J,getOptionLabel:i=>i.name,isOptionEqualToValue:(i,a)=>i.id===a.id,renderOption:(i,a)=>d.createElement("li",{...i,key:a.id},e.jsx(y,{alt:a.avatarUrl,src:a.avatarUrl,sx:{width:24,height:24,flexShrink:0,mr:1}},a.id),a.name),renderTags:(i,a)=>i.map((l,m)=>d.createElement(k,{...a({index:m}),key:l.id,size:"small",variant:"soft",label:l.name,avatar:e.jsx(y,{alt:l.name,src:l.avatarUrl})}))})]}),e.jsxs(n,{spacing:1.5,children:[e.jsx(t,{variant:"subtitle2",children:"Available"}),e.jsxs(n,{direction:{xs:"column",md:"row"},spacing:2,children:[e.jsx(F,{name:"available.startDate",control:f,render:({field:i,fieldState:{error:a}})=>e.jsx(q,{...i,format:"dd/MM/yyyy",slotProps:{textField:{fullWidth:!0,error:!!a,helperText:a==null?void 0:a.message}}})}),e.jsx(F,{name:"available.endDate",control:f,render:({field:i,fieldState:{error:a}})=>e.jsx(q,{...i,format:"dd/MM/yyyy",slotProps:{textField:{fullWidth:!0,error:!!a,helperText:a==null?void 0:a.message}}})})]})]}),e.jsxs(n,{spacing:1.5,children:[e.jsx(t,{variant:"subtitle2",children:"Duration"}),e.jsx(C,{name:"durations",placeholder:"Ex: 2 days, 4 days 3 nights..."})]}),e.jsxs(n,{spacing:1.5,children:[e.jsx(t,{variant:"subtitle2",children:"Destination"}),e.jsx(b,{name:"destination",type:"country",placeholder:"+ Destination",options:K.map(i=>i.label),getOptionLabel:i=>i})]}),e.jsxs(n,{spacing:1,children:[e.jsx(t,{variant:"subtitle2",children:"Services"}),e.jsx(ee,{name:"services",options:Q,sx:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)"}})]}),e.jsxs(n,{spacing:1.5,children:[e.jsx(t,{variant:"subtitle2",children:"Tags"}),e.jsx(b,{name:"tags",placeholder:"+ Tags",multiple:!0,freeSolo:!0,options:X.map(i=>i),getOptionLabel:i=>i,renderOption:(i,a)=>d.createElement("li",{...i,key:a},a),renderTags:(i,a)=>i.map((l,m)=>d.createElement(k,{...a({index:m}),key:l,label:l,size:"small",color:"info",variant:"soft"}))})]})]})]})})]}),_=e.jsxs(e.Fragment,{children:[x&&e.jsx(o,{md:4}),e.jsxs(o,{xs:12,md:8,sx:{display:"flex",alignItems:"center"},children:[e.jsx(ae,{control:e.jsx(ie,{defaultChecked:!0}),label:"Publish",sx:{flexGrow:1,pl:3}}),e.jsx(te,{type:"submit",variant:"contained",size:"large",loading:L,sx:{ml:2},children:s?"Save Changes":"Create Tour"})]})]});return e.jsx(u,{methods:v,onSubmit:M,children:e.jsxs(o,{container:!0,spacing:3,children:[I,V,_]})})}export{De as T};
