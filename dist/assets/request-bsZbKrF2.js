import{_ as z,r as o,t as k,a as V,J as $,u as Q,a1 as U,a5 as J,c as K,b as X,d as Y,o as Z,j as t,C as ee,K as se,p as L,B as M,R as te,g as C,F as re,a6 as ae,M as ie,S as oe,a7 as le,a8 as ne,H as de}from"./index-olWG5rmW.js";import{a as ce,b as ue}from"./role-check-5Hlc5mGT.js";import{b as me}from"./graveyard-GKlh6lSI.js";import{E as D}from"./empty-content-aEHGwk1d.js";import{R as pe}from"./rhf-select-c25tOyEz.js";import{R as fe,a as he,b as xe,d as ve,e as ge}from"./graveyard-table-row-rUx8R-Wm.js";import{D as ye}from"./DataGrid-zjjvXiyR.js";import{G as Ce,a as be}from"./GridToolbarQuickFilter-5GVOfxvI.js";import{G as N}from"./GridActionsCellItem-yab85Fz2.js";import"./Checkbox-B_BJ-Hb5.js";import"./SwitchBase-OXsTXBdw.js";import"./Chip-8rx4JbJF.js";import"./format-number-dgBbQaGG.js";import"./index-AAfoef_5.js";import"./Autocomplete-gEJAXnqc.js";import"./ClickAwayListener-FzzntR-4.js";import"./Switch-mwadsWX6.js";import"./Skeleton-utUioUnt.js";import"./TablePagination-45LyRSw3.js";import"./FirstPage-xOxBUGGE.js";import"./TableCell-ImqvOK7-.js";import"./FormControlLabel-YKJ5ioYh.js";const we=async(l,u)=>{const n=l.filter(d=>d.approved).map(async d=>{const h=u.filter(s=>s.serviceId===d.id).map(s=>{var x;const i=(x=s==null?void 0:s.graveyardDetails)==null?void 0:x.name;return s!=null&&s.approved?{...d,graveyardName:i,rapproved:!0}:{...d,graveyardName:i,rapproved:!1}});return h.length===0?d:h});return(await Promise.all(n)).flat()},je=async l=>{const u=l.map(async a=>({id:a.id,rapproved:a.approved,name:a.serviceDetails.name,unit:a.serviceDetails.unit,price:a.serviceDetails.price,graveyardName:a.graveyardDetails.name,description:a.serviceDetails.description}));return(await Promise.all(u)).flat()},Se={category:!1},Re=["category","actions"];function Ge(){const{enqueueSnackbar:l}=z(),[u,b]=o.useState(!1),[n,a]=o.useState(!1),{t:r}=k(),d=V(),h=$(),{user:s}=Q(),{services:i,servicesLoading:x}=U(s==null?void 0:s.userId),{rservices:m}=J(s==null?void 0:s.userId),{graveyards:w}=me(),[v,g]=o.useState([]),[S,q]=o.useState([]),[P,A]=o.useState(Se),F=K().shape({id:X().required("Please select Graveyard!")}),E=o.useMemo(()=>({id:""}),[]),R=Y({resolver:Z(F),defaultValues:E}),{watch:_}=R,c=_();o.useEffect(()=>{i&&g(i)},[i]),o.useEffect(()=>{s!=null&&s.role&&(b(ce(s==null?void 0:s.role)),a(ue(s==null?void 0:s.role)))},[s==null?void 0:s.role]);const G=o.useCallback(async()=>{if(i&&i.length>0&&!n){const e=await we(i,m);g(e)}if(n){const e=await je(m);g(e)}},[i,n,m]);o.useEffect(()=>{m&&(console.log("request services",m),G())},[m,G]);const B=async e=>{var p,y;try{const f=w.filter(j=>(j==null?void 0:j.id)===c.id);c!=null&&c.id||console.error("Select Graveyard!");const H={fellesraadId:((p=f[0])==null?void 0:p.fellesraadId)||"",graveyardId:(c==null?void 0:c.id)||"",serviceId:e||"",companyId:(s==null?void 0:s.userId)||""};(y=(await le(H)).searchResults)!=null&&y.success&&l("Service request success!")}catch{window.prompt("Please select the Graveyard!")}},O=async e=>{const p=await ne(e);if(p.searchResults.success){const y=v.map(f=>f.id===p.searchResults.result.id?{...f,rapproved:p.searchResults.result.approved}:f);g(y),l("Approve success!")}else console.error("Approve not success!")},T=e=>n?[t.jsx(N,{showInMenu:!0,icon:t.jsx(C,{icon:"eva:checkmark-circle-2-fill"}),label:"Approve",onClick:()=>O(e.row.id)})]:u&&!("rapproved"in e.row)?[t.jsx(N,{showInMenu:!0,icon:t.jsx(C,{icon:"solar:trash-bin-trash-bold"}),label:r("Request"),onClick:()=>B(e.row.id)})]:[],I=[{field:"name",headerName:r("service_name"),flex:1,minWidth:100,hideable:!1,disableColumnMenu:!0,renderCell:e=>t.jsx(fe,{params:e})},{field:"description",headerName:r("description"),minWidth:280,disableColumnMenu:!0,renderCell:e=>t.jsx(he,{params:e})},{field:"price",headerName:r("price"),minWidth:110,disableColumnMenu:!0,renderCell:e=>t.jsx(xe,{params:e})},{field:"Graveyard",headerName:r("Graveyard"),minWidth:280,type:"singleSelect",disableColumnMenu:!0,renderCell:e=>t.jsx(ve,{params:e})},{field:"Approve",headerName:r("Approve"),minWidth:110,type:"singleSelect",disableColumnMenu:!0,renderCell:e=>t.jsx(ge,{params:e})},{type:"actions",field:"actions",headerName:" ",align:"right",headerAlign:"right",width:80,sortable:!1,filterable:!1,disableColumnMenu:!0,getActions:e=>T(e)}],W=()=>I.filter(e=>!Re.includes(e.field)).map(e=>e.field);return t.jsxs(ee,{maxWidth:h.themeStretch?!1:"lg",sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[t.jsx(se,{heading:r("List"),links:[{name:r("service"),href:L.fellesraad.service.root},{name:r("List")}],action:u&&t.jsx(M,{component:te,href:L.fellesraad.service.create,variant:"contained",startIcon:t.jsx(C,{icon:"mingcute:add-line"}),children:r("new_service")}),sx:{mb:{xs:3,md:5}}}),w&&!n&&t.jsx(re,{methods:R,children:t.jsx(pe,{fullWidth:!0,name:"id",label:r("Graveyard"),InputLabelProps:{shrink:!0},PaperPropsSx:{textTransform:"capitalize"},sx:{mb:1},children:w.map(e=>(e==null?void 0:e.approved)&&t.jsx(ae,{value:e==null?void 0:e.id,children:e==null?void 0:e.name},e.id))})}),t.jsx(ie,{sx:{height:{xs:800,md:2},flexGrow:{md:1},display:{md:"flex"},flexDirection:{md:"column"},px:3},children:v&&v.length>0&&t.jsx(ye,{disableRowSelectionOnClick:!0,rows:v,columns:I,loading:x,getRowHeight:()=>"auto",pageSizeOptions:[5,10,25],initialState:{pagination:{paginationModel:{pageSize:10}}},onRowSelectionModelChange:e=>{q(e)},columnVisibilityModel:P,onColumnVisibilityModelChange:e=>A(e),slots:{toolbar:()=>t.jsxs(Ce,{children:[t.jsx(be,{}),t.jsx(oe,{spacing:1,flexGrow:1,direction:"row",alignItems:"center",justifyContent:"flex-end",children:!!S.length&&t.jsxs(M,{size:"small",color:"error",startIcon:t.jsx(C,{icon:"solar:trash-bin-trash-bold"}),onClick:d.onTrue,children:["Delete (",S.length,")"]})})]}),noRowsOverlay:()=>t.jsx(D,{title:"No Data"}),noResultsOverlay:()=>t.jsx(D,{title:"No results found"})},slotProps:{columnsPanel:{getTogglableColumns:W}}})})]})}function Ke(){const{t:l}=k();return t.jsxs(t.Fragment,{children:[t.jsx(de,{children:t.jsxs("title",{children:[" ",`${l("services")}: ${l("list_of_services")}`]})}),t.jsx(Ge,{})]})}export{Ke as default};
