import{ck as K,dm as X,V as v,ea as Y,r as S,e0 as W,j as e,S as l,B as h,T as j,K as F,f as b,bk as z,I as R,bq as Z,t as A,h as w,aV as I,b as q,g as B,a0 as P,W as V,k as ee,c as L,eb as $,ec as se,dz as C,d as k,e as te,o as ae,p as _,F as ie,v as le,i as O,dS as oe}from"./index-CEsfQFse.js";import{_ as ne}from"./_baseSum-gu02AyRp.js";import{f as T}from"./format-number-jm6-t6vV.js";import{R as H}from"./rhf-select-Bc6nT737.js";import{A as Q}from"./address-list-dialog--lkm4MRu.js";import{D as G}from"./DatePicker-Cc9EJyIp.js";var re=ne,de=X;function me(s){return s&&s.length?re(s,de):0}var ce=me;const xe=K(ce);function he(){const{control:s,setValue:o,watch:p,resetField:i}=v(),{fields:d,append:m,remove:c}=Y({control:s,name:"items"}),t=p(),g=t.items.map(r=>r.quantity*r.price),y=xe(g),x=y-t.discount-t.shipping+t.taxes;S.useEffect(()=>{o("totalAmount",x)},[o,x]);const N=()=>{m({title:"",description:"",service:"",quantity:1,price:0,total:0})},f=r=>{c(r)},u=S.useCallback(r=>{i(`items[${r}].quantity`),i(`items[${r}].price`),i(`items[${r}].total`)},[i]),J=S.useCallback((r,a)=>{var n;o(`items[${r}].price`,(n=W.find(D=>D.name===a))==null?void 0:n.price),o(`items[${r}].total`,t.items.map(D=>D.quantity*D.price)[r])},[o,t.items]),M=S.useCallback((r,a)=>{o(`items[${a}].quantity`,Number(r.target.value)),o(`items[${a}].total`,t.items.map(n=>n.quantity*n.price)[a])},[o,t.items]),E=S.useCallback((r,a)=>{o(`items[${a}].price`,Number(r.target.value)),o(`items[${a}].total`,t.items.map(n=>n.quantity*n.price)[a])},[o,t.items]),U=e.jsxs(l,{spacing:2,alignItems:"flex-end",sx:{mt:3,textAlign:"right",typography:"body2"},children:[e.jsxs(l,{direction:"row",children:[e.jsx(h,{sx:{color:"text.secondary"},children:"Subtotal"}),e.jsx(h,{sx:{width:160,typography:"subtitle2"},children:T(y)||"-"})]}),e.jsxs(l,{direction:"row",children:[e.jsx(h,{sx:{color:"text.secondary"},children:"Shipping"}),e.jsx(h,{sx:{width:160,...t.shipping&&{color:"error.main"}},children:t.shipping?`- ${T(t.shipping)}`:"-"})]}),e.jsxs(l,{direction:"row",children:[e.jsx(h,{sx:{color:"text.secondary"},children:"Discount"}),e.jsx(h,{sx:{width:160,...t.discount&&{color:"error.main"}},children:t.discount?`- ${T(t.discount)}`:"-"})]}),e.jsxs(l,{direction:"row",children:[e.jsx(h,{sx:{color:"text.secondary"},children:"Taxes"}),e.jsx(h,{sx:{width:160},children:t.taxes?T(t.taxes):"-"})]}),e.jsxs(l,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx(h,{children:"Total"}),e.jsx(h,{sx:{width:160},children:T(x)||"-"})]})]});return e.jsxs(h,{sx:{p:3},children:[e.jsx(j,{variant:"h6",sx:{color:"text.disabled",mb:3},children:"Details:"}),e.jsx(l,{divider:e.jsx(F,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,children:d.map((r,a)=>e.jsxs(l,{alignItems:"flex-end",spacing:1.5,children:[e.jsxs(l,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:1},children:[e.jsx(b,{size:"small",name:`items[${a}].title`,label:"Title",InputLabelProps:{shrink:!0}}),e.jsx(b,{size:"small",name:`items[${a}].description`,label:"Description",InputLabelProps:{shrink:!0}}),e.jsxs(H,{name:`items[${a}].service`,size:"small",label:"Service",InputLabelProps:{shrink:!0},sx:{maxWidth:{md:160}},children:[e.jsx(z,{value:"",onClick:()=>u(a),sx:{fontStyle:"italic",color:"text.secondary"},children:"None"}),e.jsx(F,{sx:{borderStyle:"dashed"}}),W.map(n=>e.jsx(z,{value:n.name,onClick:()=>J(a,n.name),children:n.name},n.id))]}),e.jsx(b,{size:"small",type:"number",name:`items[${a}].quantity`,label:"Quantity",placeholder:"0",onChange:n=>M(n,a),InputLabelProps:{shrink:!0},sx:{maxWidth:{md:96}}}),e.jsx(b,{size:"small",type:"number",name:`items[${a}].price`,label:"Price",placeholder:"0.00",onChange:n=>E(n,a),InputProps:{startAdornment:e.jsx(R,{position:"start",children:e.jsx(h,{sx:{typography:"subtitle2",color:"text.disabled"},children:"$"})})},sx:{maxWidth:{md:96}}}),e.jsx(b,{disabled:!0,size:"small",type:"number",name:`items[${a}].total`,label:"Total",placeholder:"0.00",value:t.items[a].total===0?"":t.items[a].total.toFixed(2),onChange:n=>E(n,a),InputProps:{startAdornment:e.jsx(R,{position:"start",children:e.jsx(h,{sx:{typography:"subtitle2",color:"text.disabled"},children:"$"})})},sx:{maxWidth:{md:104},[`& .${Z.input}`]:{textAlign:{md:"right"}}}})]}),e.jsx(A,{size:"small",color:"error",startIcon:e.jsx(w,{icon:"solar:trash-bin-trash-bold"}),onClick:()=>f(a),children:"Remove"})]},r.id))}),e.jsx(F,{sx:{my:3,borderStyle:"dashed"}}),e.jsxs(l,{spacing:3,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:[e.jsx(A,{size:"small",color:"primary",startIcon:e.jsx(w,{icon:"mingcute:add-line"}),onClick:N,sx:{flexShrink:0},children:"Add Item"}),e.jsxs(l,{spacing:2,justifyContent:"flex-end",direction:{xs:"column",md:"row"},sx:{width:1},children:[e.jsx(b,{size:"small",label:"Shipping($)",name:"shipping",type:"number",sx:{maxWidth:{md:120}}}),e.jsx(b,{size:"small",label:"Discount($)",name:"discount",type:"number",sx:{maxWidth:{md:120}}}),e.jsx(b,{size:"small",label:"Taxes(%)",name:"taxes",type:"number",sx:{maxWidth:{md:120}}})]})]}),U]})}function ue(){var y;const{watch:s,setValue:o,formState:{errors:p}}=v(),i=I("up","md"),d=s(),{invoiceFrom:m,invoiceTo:c}=d,t=q(),g=q();return e.jsxs(e.Fragment,{children:[e.jsxs(l,{spacing:{xs:3,md:5},direction:{xs:"column",md:"row"},divider:e.jsx(F,{flexItem:!0,orientation:i?"vertical":"horizontal",sx:{borderStyle:"dashed"}}),sx:{p:3},children:[e.jsxs(l,{sx:{width:1},children:[e.jsxs(l,{direction:"row",alignItems:"center",sx:{mb:1},children:[e.jsx(j,{variant:"h6",sx:{color:"text.disabled",flexGrow:1},children:"From:"}),e.jsx(B,{onClick:t.onTrue,children:e.jsx(w,{icon:"solar:pen-bold"})})]}),e.jsxs(l,{spacing:1,children:[e.jsx(j,{variant:"subtitle2",children:m.name}),e.jsx(j,{variant:"body2",children:m.fullAddress}),e.jsxs(j,{variant:"body2",children:[" ",m.phoneNumber]})]})]}),e.jsxs(l,{sx:{width:1},children:[e.jsxs(l,{direction:"row",alignItems:"center",sx:{mb:1},children:[e.jsx(j,{variant:"h6",sx:{color:"text.disabled",flexGrow:1},children:"To:"}),e.jsx(B,{onClick:g.onTrue,children:e.jsx(w,{icon:c?"solar:pen-bold":"mingcute:add-line"})})]}),c?e.jsxs(l,{spacing:1,children:[e.jsx(j,{variant:"subtitle2",children:c.name}),e.jsx(j,{variant:"body2",children:c.fullAddress}),e.jsxs(j,{variant:"body2",children:[" ",c.phoneNumber]})]}):e.jsx(j,{typography:"caption",sx:{color:"error.main"},children:(y=p.invoiceTo)==null?void 0:y.message})]})]}),e.jsx(Q,{title:"Customers",open:t.value,onClose:t.onFalse,selected:x=>(m==null?void 0:m.id)===x,onSelect:x=>o("invoiceFrom",x),list:P,action:e.jsx(A,{size:"small",startIcon:e.jsx(w,{icon:"mingcute:add-line"}),sx:{alignSelf:"flex-end"},children:"New"})}),e.jsx(Q,{title:"Customers",open:g.value,onClose:g.onFalse,selected:x=>(c==null?void 0:c.id)===x,onSelect:x=>o("invoiceTo",x),list:P,action:e.jsx(A,{size:"small",startIcon:e.jsx(w,{icon:"mingcute:add-line"}),sx:{alignSelf:"flex-end"},children:"New"})})]})}function pe(){const{control:s,watch:o}=v(),p=o();return e.jsxs(l,{spacing:2,direction:{xs:"column",sm:"row"},sx:{p:3,bgcolor:"background.neutral"},children:[e.jsx(b,{disabled:!0,name:"invoiceNumber",label:"Invoice number",value:p.invoiceNumber}),e.jsx(H,{fullWidth:!0,name:"status",label:"Status",InputLabelProps:{shrink:!0},PaperPropsSx:{textTransform:"capitalize"},children:["paid","pending","overdue","draft"].map(i=>e.jsx(z,{value:i,children:i},i))}),e.jsx(V,{name:"createDate",control:s,render:({field:i,fieldState:{error:d}})=>e.jsx(G,{label:"Date create",value:i.value,onChange:m=>{i.onChange(m)},slotProps:{textField:{fullWidth:!0,error:!!d,helperText:d==null?void 0:d.message}}})}),e.jsx(V,{name:"dueDate",control:s,render:({field:i,fieldState:{error:d}})=>e.jsx(G,{label:"Due date",value:i.value,onChange:m=>{i.onChange(m)},slotProps:{textField:{fullWidth:!0,error:!!d,helperText:d==null?void 0:d.message}}})})]})}function we({currentInvoice:s}){const o=ee(),p=q(),i=q(),d=L().shape({invoiceTo:$().nullable().required("Invoice to is required"),createDate:$().nullable().required("Create date is required"),dueDate:$().required("Due date is required").test("date-min","Due date must be later than create date",(f,{parent:u})=>f.getTime()>u.createDate.getTime()),items:se(()=>oe().of(L({title:k().required("Title is required"),service:k().required("Service is required"),quantity:C().required("Quantity is required").min(1,"Quantity must be more than 0")}))),taxes:C(),status:k(),discount:C(),shipping:C(),invoiceFrom:$(),totalAmount:C(),invoiceNumber:k()}),m=S.useMemo(()=>({invoiceNumber:(s==null?void 0:s.invoiceNumber)||"INV-1990",createDate:(s==null?void 0:s.createDate)||new Date,dueDate:(s==null?void 0:s.dueDate)||null,taxes:(s==null?void 0:s.taxes)||0,shipping:(s==null?void 0:s.shipping)||0,status:(s==null?void 0:s.status)||"draft",discount:(s==null?void 0:s.discount)||0,invoiceFrom:(s==null?void 0:s.invoiceFrom)||P[0],invoiceTo:(s==null?void 0:s.invoiceTo)||null,items:(s==null?void 0:s.items)||[{title:"",description:"",service:"",quantity:1,price:0,total:0}],totalAmount:(s==null?void 0:s.totalAmount)||0}),[s]),c=te({resolver:ae(d),defaultValues:m}),{reset:t,handleSubmit:g,formState:{isSubmitting:y}}=c,x=g(async f=>{p.onTrue();try{await new Promise(u=>setTimeout(u,500)),t(),p.onFalse(),o.push(_.dashboard.invoice.root),console.info("DATA",JSON.stringify(f,null,2))}catch(u){console.error(u),p.onFalse()}}),N=g(async f=>{i.onTrue();try{await new Promise(u=>setTimeout(u,500)),t(),i.onFalse(),o.push(_.dashboard.invoice.root),console.info("DATA",JSON.stringify(f,null,2))}catch(u){console.error(u),i.onFalse()}});return e.jsxs(ie,{methods:c,children:[e.jsxs(le,{children:[e.jsx(ue,{}),e.jsx(pe,{}),e.jsx(he,{})]}),e.jsxs(l,{justifyContent:"flex-end",direction:"row",spacing:2,sx:{mt:3},children:[e.jsx(O,{color:"inherit",size:"large",variant:"outlined",loading:p.value&&y,onClick:x,children:"Save as Draft"}),e.jsxs(O,{size:"large",variant:"contained",loading:i.value&&y,onClick:N,children:[s?"Update":"Create"," & Send"]})]})]})}export{we as I};
