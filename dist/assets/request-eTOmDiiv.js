import{Z as z,r as o,u as k,b as V,G as $,a as Q,a0 as U,a4 as J,c as K,d as Z,e as X,o as Y,j as t,C as ee,J as se,p as L,B as M,R as te,h as C,F as re,a5 as ae,K as ie,S as oe,a6 as le,a7 as ne,H as de}from"./index-HKvYvq3j.js";import{a as ce,b as me}from"./role-check-5Hlc5mGT.js";import{b as ue}from"./graveyard-zrdqr7Mr.js";import{E as D}from"./empty-content-ikLVFtYm.js";import{R as pe}from"./rhf-select-Rx46kXLL.js";import{R as fe,a as he,b as xe,d as ve}from"./graveyard-table-row-wcDTvyVp.js";import{D as ge}from"./DataGrid-DpAWUB_n.js";import{G as ye,a as Ce}from"./GridToolbarQuickFilter-hJ5G_Pju.js";import{G as N}from"./GridActionsCellItem-LEzex8T7.js";import"./Checkbox-vB-XJoJj.js";import"./SwitchBase-dhyrm6Co.js";import"./Chip-0IbGJdtD.js";import"./format-number-atgkyq5m.js";import"./index-6AoZoM6i.js";import"./Autocomplete-pGPdnYFd.js";import"./ClickAwayListener-ieEBWmID.js";import"./Switch-Hi_VICkA.js";import"./Skeleton-yXkKr8fp.js";import"./TablePagination-APv1Zc7q.js";import"./KeyboardArrowRight-bbyronaV.js";import"./FirstPage-DSIFeLwz.js";import"./TableCell-96gyKv7u.js";import"./FormControlLabel-AwOrzazp.js";const be=async(l,m)=>{const n=l.filter(d=>d.approved).map(async d=>{const h=m.filter(s=>s.serviceId===d.id).map(s=>{var x;const i=(x=s==null?void 0:s.graveyardDetails)==null?void 0:x.name;return s!=null&&s.approved?{...d,graveyardName:i,rapproved:!0}:{...d,graveyardName:i,rapproved:!1}});return h.length===0?d:h});return(await Promise.all(n)).flat()},we=async l=>{const m=l.map(async a=>({id:a.id,rapproved:a.approved,name:a.serviceDetails.name,unit:a.serviceDetails.unit,price:a.serviceDetails.price,graveyardName:a.graveyardDetails.name,description:a.serviceDetails.description}));return(await Promise.all(m)).flat()},Se={category:!1},je=["category","actions"];function Re(){const{enqueueSnackbar:l}=z(),[m,b]=o.useState(!1),[n,a]=o.useState(!1),{t:r}=k(),d=V(),h=$(),{user:s}=Q(),{services:i,servicesLoading:x}=U(s==null?void 0:s.userId),{rservices:u}=J(s==null?void 0:s.userId),{graveyards:w}=ue(),[v,g]=o.useState([]),[j,P]=o.useState([]),[q,A]=o.useState(Se),F=K().shape({id:Z().required("Please select Graveyard!")}),E=o.useMemo(()=>({id:""}),[]),R=X({resolver:Y(F),defaultValues:E}),{watch:B}=R,c=B();o.useEffect(()=>{i&&g(i)},[i]),o.useEffect(()=>{s!=null&&s.role&&(b(ce(s==null?void 0:s.role)),a(me(s==null?void 0:s.role)))},[s==null?void 0:s.role]);const I=o.useCallback(async()=>{if(i&&i.length>0&&!n){const e=await be(i,u);g(e)}if(n){const e=await we(u);g(e)}},[i,n,u]);console.log("sdfas"),o.useEffect(()=>{u&&(console.log("request services",u),I())},[u,I]);const O=async e=>{var p,y;try{const f=w.filter(S=>(S==null?void 0:S.id)===c.id);c!=null&&c.id||console.error("Select Graveyard!");const _={fellesraadId:((p=f[0])==null?void 0:p.fellesraadId)||"",graveyardId:(c==null?void 0:c.id)||"",serviceId:e||"",companyId:(s==null?void 0:s.userId)||""};(y=(await le(_)).searchResults)!=null&&y.success&&l("Service request success!")}catch{window.prompt("Please select the Graveyard!")}},T=async e=>{const p=await ne(e);if(p.searchResults.success){const y=v.map(f=>f.id===p.searchResults.result.id?{...f,rapproved:p.searchResults.result.approved}:f);g(y),l("Approve success!")}else console.error("Approve not success!")},H=e=>n?[t.jsx(N,{showInMenu:!0,icon:t.jsx(C,{icon:"eva:checkmark-circle-2-fill"}),label:r("Approve"),onClick:()=>T(e.row.id)})]:m&&!("rapproved"in e.row)?[t.jsx(N,{showInMenu:!0,icon:t.jsx(C,{icon:"solar:trash-bin-trash-bold"}),label:r("request"),onClick:()=>O(e.row.id)})]:[],G=[{field:"name",headerName:r("service_name"),flex:1,minWidth:100,hideable:!1,disableColumnMenu:!0,renderCell:e=>t.jsx(fe,{params:e})},{field:"description",headerName:r("description"),minWidth:280,disableColumnMenu:!0,renderCell:e=>t.jsx(he,{params:e})},{field:"price",headerName:r("price"),minWidth:110,disableColumnMenu:!0,renderCell:e=>t.jsx(xe,{params:e})},{field:"Approve",headerName:r("Approve"),minWidth:110,type:"singleSelect",disableColumnMenu:!0,renderCell:e=>t.jsx(ve,{params:e})},{type:"actions",field:"actions",headerName:" ",align:"right",headerAlign:"right",width:80,sortable:!1,filterable:!1,disableColumnMenu:!0,getActions:e=>H(e)}],W=()=>G.filter(e=>!je.includes(e.field)).map(e=>e.field);return t.jsxs(ee,{maxWidth:h.themeStretch?!1:"lg",sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[t.jsx(se,{heading:r("List"),links:[{name:r("service"),href:L.fellesraad.service.root},{name:r("List")}],action:m&&t.jsx(M,{component:te,href:L.fellesraad.service.create,variant:"contained",startIcon:t.jsx(C,{icon:"mingcute:add-line"}),children:r("New Service")}),sx:{mb:{xs:3,md:5}}}),w&&!n&&t.jsx(re,{methods:R,children:t.jsx(pe,{fullWidth:!0,name:"id",label:r("Graveyard"),InputLabelProps:{shrink:!0},PaperPropsSx:{textTransform:"capitalize"},sx:{mb:1},children:w.map(e=>(e==null?void 0:e.approved)&&t.jsx(ae,{value:e==null?void 0:e.id,children:e==null?void 0:e.name},e.id))})}),t.jsx(ie,{sx:{height:{xs:800,md:2},flexGrow:{md:1},display:{md:"flex"},flexDirection:{md:"column"},px:3},children:v&&v.length>0&&t.jsx(ge,{disableRowSelectionOnClick:!0,rows:v,columns:G,loading:x,getRowHeight:()=>"auto",pageSizeOptions:[5,10,25],initialState:{pagination:{paginationModel:{pageSize:10}}},onRowSelectionModelChange:e=>{P(e)},columnVisibilityModel:q,onColumnVisibilityModelChange:e=>A(e),slots:{toolbar:()=>t.jsxs(ye,{children:[t.jsx(Ce,{}),t.jsx(oe,{spacing:1,flexGrow:1,direction:"row",alignItems:"center",justifyContent:"flex-end",children:!!j.length&&t.jsxs(M,{size:"small",color:"error",startIcon:t.jsx(C,{icon:"solar:trash-bin-trash-bold"}),onClick:d.onTrue,children:["Delete (",j.length,")"]})})]}),noRowsOverlay:()=>t.jsx(D,{title:"No Data"}),noResultsOverlay:()=>t.jsx(D,{title:"No results found"})},slotProps:{columnsPanel:{getTogglableColumns:W}}})})]})}function Ke(){const{t:l}=k();return t.jsxs(t.Fragment,{children:[t.jsx(de,{children:t.jsxs("title",{children:[" ",`${l("services")}: ${l("list_of_services")}`]})}),t.jsx(Re,{})]})}export{Ke as default};
