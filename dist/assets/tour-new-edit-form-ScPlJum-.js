import{k as $,b2 as G,Z as W,c as y,d as h,bs as r,bH as D,r as d,e as B,o as K,p as Y,j as e,M as o,T as t,K as S,ai as F,S as n,e8 as Z,Y as R,ak as C,f as k,c0 as J,e4 as Q,bx as X,F as u,i as T}from"./index-F58UWM6d.js";import{R as ee}from"./rhf-upload-w6ayJQZC.js";import{R as se}from"./rhf-checkbox-McPdbg24.js";import{R as ae}from"./rhf-editor-BduiPwIF.js";import{R as b}from"./rhf-autocomplete-FL3X_1RD.js";import{C as E}from"./Chip-Bf9OfEDF.js";import{D as q}from"./DatePicker-k9SVsDE2.js";import{F as ie}from"./FormControlLabel-yEUOmb-6.js";import{S as te}from"./Switch-mI38wMsz.js";function re({currentTour:s}){const O=$(),c=G("up","md"),{enqueueSnackbar:w}=W(),A=y().shape({name:h().required("Name is required"),content:h().required("Content is required"),images:r().min(1,"Images is required"),tourGuides:r().min(1,"Must have at least 1 guide"),durations:h().required("Duration is required"),tags:r().min(2,"Must have at least 2 tags"),services:r().min(2,"Must have at least 2 services"),destination:h().required("Destination is required"),available:y().shape({startDate:D().nullable().required("Start date is required"),endDate:D().required("End date is required").test("date-min","End date must be later than start date",(i,{parent:a})=>i.getTime()>a.startDate.getTime())})}),j=d.useMemo(()=>({name:(s==null?void 0:s.name)||"",content:(s==null?void 0:s.content)||"",images:(s==null?void 0:s.images)||[],tourGuides:(s==null?void 0:s.tourGuides)||[],tags:(s==null?void 0:s.tags)||[],durations:(s==null?void 0:s.durations)||"",destination:(s==null?void 0:s.destination)||"",services:(s==null?void 0:s.services)||[],available:{startDate:(s==null?void 0:s.available.startDate)||null,endDate:(s==null?void 0:s.available.endDate)||null}}),[s]),v=B({resolver:K(A),defaultValues:j}),{watch:P,reset:g,control:f,setValue:x,handleSubmit:U,formState:{isSubmitting:M}}=v,p=P();d.useEffect(()=>{s&&g(j)},[s,j,g]);const L=U(async i=>{try{await new Promise(a=>setTimeout(a,500)),g(),w(s?"Update success!":"Create success!"),O.push(Y.dashboard.tour.root),console.info("DATA",i)}catch(a){console.error(a)}}),H=d.useCallback(i=>{const a=p.images||[],l=i.map(m=>Object.assign(m,{preview:URL.createObjectURL(m)}));x("images",[...a,...l],{shouldValidate:!0})},[x,p.images]),N=d.useCallback(i=>{var l;const a=p.images&&((l=p.images)==null?void 0:l.filter(m=>m!==i));x("images",a)},[x,p.images]),I=d.useCallback(()=>{x("images",[])},[x]),V=e.jsxs(e.Fragment,{children:[c&&e.jsxs(o,{md:4,children:[e.jsx(t,{variant:"h6",sx:{mb:.5},children:"Details"}),e.jsx(t,{variant:"body2",sx:{color:"text.secondary"},children:"Title, short description, image..."})]}),e.jsx(o,{xs:12,md:8,children:e.jsxs(S,{children:[!c&&e.jsx(F,{title:"Details"}),e.jsxs(n,{spacing:3,sx:{p:3},children:[e.jsxs(n,{spacing:1.5,children:[e.jsx(t,{variant:"subtitle2",children:"Name"}),e.jsx(k,{name:"name",placeholder:"Ex: Adventure Seekers Expedition..."})]}),e.jsxs(n,{spacing:1.5,children:[e.jsx(t,{variant:"subtitle2",children:"Content"}),e.jsx(ae,{simple:!0,name:"content"})]}),e.jsxs(n,{spacing:1.5,children:[e.jsx(t,{variant:"subtitle2",children:"Images"}),e.jsx(ee,{multiple:!0,thumbnail:!0,name:"images",maxSize:3145728,onDrop:H,onRemove:N,onRemoveAll:I,onUpload:()=>console.info("ON UPLOAD")})]})]})]})})]}),z=e.jsxs(e.Fragment,{children:[c&&e.jsxs(o,{md:4,children:[e.jsx(t,{variant:"h6",sx:{mb:.5},children:"Properties"}),e.jsx(t,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(o,{xs:12,md:8,children:e.jsxs(S,{children:[!c&&e.jsx(F,{title:"Properties"}),e.jsxs(n,{spacing:3,sx:{p:3},children:[e.jsxs(n,{children:[e.jsx(t,{variant:"subtitle2",sx:{mb:1.5},children:"Tour Guide"}),e.jsx(b,{multiple:!0,name:"tourGuides",placeholder:"+ Tour Guides",disableCloseOnSelect:!0,options:Z,getOptionLabel:i=>i.name,isOptionEqualToValue:(i,a)=>i.id===a.id,renderOption:(i,a)=>d.createElement("li",{...i,key:a.id},e.jsx(R,{alt:a.avatarUrl,src:a.avatarUrl,sx:{width:24,height:24,flexShrink:0,mr:1}},a.id),a.name),renderTags:(i,a)=>i.map((l,m)=>d.createElement(E,{...a({index:m}),key:l.id,size:"small",variant:"soft",label:l.name,avatar:e.jsx(R,{alt:l.name,src:l.avatarUrl})}))})]}),e.jsxs(n,{spacing:1.5,children:[e.jsx(t,{variant:"subtitle2",children:"Available"}),e.jsxs(n,{direction:{xs:"column",md:"row"},spacing:2,children:[e.jsx(C,{name:"available.startDate",control:f,render:({field:i,fieldState:{error:a}})=>e.jsx(q,{...i,format:"dd/MM/yyyy",slotProps:{textField:{fullWidth:!0,error:!!a,helperText:a==null?void 0:a.message}}})}),e.jsx(C,{name:"available.endDate",control:f,render:({field:i,fieldState:{error:a}})=>e.jsx(q,{...i,format:"dd/MM/yyyy",slotProps:{textField:{fullWidth:!0,error:!!a,helperText:a==null?void 0:a.message}}})})]})]}),e.jsxs(n,{spacing:1.5,children:[e.jsx(t,{variant:"subtitle2",children:"Duration"}),e.jsx(k,{name:"durations",placeholder:"Ex: 2 days, 4 days 3 nights..."})]}),e.jsxs(n,{spacing:1.5,children:[e.jsx(t,{variant:"subtitle2",children:"Destination"}),e.jsx(b,{name:"destination",type:"country",placeholder:"+ Destination",options:J.map(i=>i.label),getOptionLabel:i=>i})]}),e.jsxs(n,{spacing:1,children:[e.jsx(t,{variant:"subtitle2",children:"Services"}),e.jsx(se,{name:"services",options:Q,sx:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)"}})]}),e.jsxs(n,{spacing:1.5,children:[e.jsx(t,{variant:"subtitle2",children:"Tags"}),e.jsx(b,{name:"tags",placeholder:"+ Tags",multiple:!0,freeSolo:!0,options:X.map(i=>i),getOptionLabel:i=>i,renderOption:(i,a)=>d.createElement("li",{...i,key:a},a),renderTags:(i,a)=>i.map((l,m)=>d.createElement(E,{...a({index:m}),key:l,label:l,size:"small",color:"info",variant:"soft"}))})]})]})]})})]}),_=e.jsxs(e.Fragment,{children:[c&&e.jsx(o,{md:4}),e.jsxs(o,{xs:12,md:8,sx:{display:"flex",alignItems:"center"},children:[e.jsx(ie,{control:e.jsx(te,{defaultChecked:!0}),label:"Publish",sx:{flexGrow:1,pl:3}}),e.jsx(T,{type:"submit",variant:"contained",size:"large",loading:M,sx:{ml:2},children:s?"Save Changes":"Create Tour"})]})]});return e.jsx(u,{methods:v,onSubmit:L,children:e.jsxs(o,{container:!0,spacing:3,children:[V,z,_]})})}export{re as T};
