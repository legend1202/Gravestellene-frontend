import{j as e,q as l,B as c,z as D,S as x,u as O,r as o,w as L,v as G,C as N,x as R,p as I,y as T,g as E}from"./index-zFfPxWlY.js";import{i as k}from"./role-check-5Hlc5mGT.js";import{G as M,A as P}from"./order-L72wj292.js";import{E as m}from"./empty-content-EBAcp_-R.js";import{f as B}from"./format-number-76EDHf4S.js";import{D as W,G as H}from"./DataGrid-P9SA7TUW.js";function U({params:r}){return e.jsx(e.Fragment,{children:r.row.serviceDetails.map(s=>e.jsx(l,{disableTypography:!0,primary:e.jsx(c,{component:"div",sx:{typography:"body2",color:"text.disabled"},children:B(s.price)}),sx:{display:"flex",flexDirection:"column"}},s.id))})}function _({params:r}){return e.jsx(D,{variant:"soft",color:r.row.approved&&"info"||"default",children:r.row.approved?"Approved":"Draft"})}function z({params:r}){return e.jsx(l,{primary:r.row.gravestoneDetails.graveSite,primaryTypographyProps:{typography:"body2",noWrap:!0}})}function V({params:r}){return e.jsx(x,{direction:"row",alignItems:"center",sx:{py:2,width:1},children:r.row.serviceDetails.map(s=>e.jsx(l,{disableTypography:!0,primary:e.jsx(c,{component:"div",sx:{typography:"body2",color:"text.disabled"},children:s.name}),sx:{display:"flex",flexDirection:"column"}},s.id))})}function q({params:r}){return e.jsx(x,{direction:"row",alignItems:"center",sx:{py:2,width:1},children:e.jsx(l,{disableTypography:!0,primary:e.jsx(c,{component:"div",sx:{typography:"body2",color:"text.disabled"},children:r.row.userDetails.name})})})}const f=[{value:"approved",label:"Approved"},{value:"draft",label:"Draft"}],F={category:!1},J=["category","actions"];function ee(){const{user:r}=O(),[s,h]=o.useState(!1),{enqueueSnackbar:y}=L(),g=G(),{orders:a,ordersLoading:v}=M(),[p,n]=o.useState([]),[b,C]=o.useState(F);o.useEffect(()=>{r!=null&&r.role&&h(k(r==null?void 0:r.role))},[r==null?void 0:r.role]),o.useEffect(()=>{if(a&&a.length>0)if(s)n(a);else{const t=a.filter(i=>(i==null?void 0:i.approved)===!0);n(t)}},[a,s]);const j=async t=>{const i=await P(t);if(i.results.success){const A=p.map(d=>d.id===i.results.result.id?{...d,approved:i.results.result.approved}:d);n(A),y("Approve success!")}else console.error("Approve not success!")},w=t=>s?[e.jsx(H,{showInMenu:!0,icon:e.jsx(E,{icon:"eva:checkmark-circle-2-fill"}),label:"Approve",onClick:()=>j(t.row.id)})]:[],u=[{field:"name",headerName:"Client",flex:1,minWidth:140,hideable:!1,renderCell:t=>e.jsx(q,{params:t})},{field:"orders",headerName:"Orders",minWidth:140,renderCell:t=>e.jsx(V,{params:t})},{field:"price",headerName:"Price",minWidth:140,renderCell:t=>e.jsx(U,{params:t})},{field:"gravestone",headerName:"Gravestone",width:110,type:"singleSelect",editable:!0,valueOptions:f,renderCell:t=>e.jsx(z,{params:t})},{field:"approve",headerName:"Approve",width:110,type:"singleSelect",editable:!0,valueOptions:f,renderCell:t=>e.jsx(_,{params:t})},{type:"actions",field:"actions",headerName:" ",align:"right",headerAlign:"right",width:80,sortable:!1,filterable:!1,disableColumnMenu:!0,getActions:t=>w(t)}],S=()=>u.filter(t=>!J.includes(t.field)).map(t=>t.field);return e.jsxs(N,{maxWidth:g.themeStretch?!1:"lg",sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(R,{heading:"List",links:[{name:"Order",href:I.dashboard.root},{name:"List"}],sx:{mb:{xs:3,md:5}}}),e.jsx(T,{sx:{height:{xs:800,md:2},px:3,flexGrow:{md:1},display:{md:"flex"},flexDirection:{md:"column"}},children:a&&e.jsx(W,{disableRowSelectionOnClick:!0,rows:p,columns:u,loading:v,getRowHeight:()=>"auto",pageSizeOptions:[5,10,25],initialState:{pagination:{paginationModel:{pageSize:10}}},columnVisibilityModel:b,onColumnVisibilityModelChange:t=>C(t),slots:{noRowsOverlay:()=>e.jsx(m,{title:"No Data"}),noResultsOverlay:()=>e.jsx(m,{title:"No results found"})},slotProps:{columnsPanel:{getTogglableColumns:S}}})})]})}export{ee as O};
